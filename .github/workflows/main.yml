name: Continuous Bot Runner

on:
  schedule:
    # ุณูุชู ุชุดุบูู ุงูุจูุช ูู 4 ุณุงุนุงุช (00:00, 04:00, 08:00, 12:00, 16:00, 20:00) UTC
    # ููุงุญุธุฉ: ุงููุณุฎุฉ ุงูุฌุฏูุฏุฉ ุณุชููู ุจุฅููุงู ุงููุฏููุฉ ุชููุงุฆูุงู ุจูุถู ุงูู concurrency
    - cron: '0 */4 * * *' 
  workflow_dispatch:

concurrency:
  group: wolf-bot-running
  # ูุฐุง ุงูุณุทุฑ ูุถูู ุชุดุบูู ูุณุฎุฉ ูุงุญุฏุฉ ููุทุ ุณููุชู ุงููุณุฎุฉ ุงููุฏููุฉ ููุฑ ุจุฏุก ุงูุฌุฏูุฏุฉ
  cancel-in-progress: true 

jobs:
  run-bot:
    runs-on: ubuntu-latest
    # ุชู ุฑูุน ุงููููุฉ ุฅูู 305 ุฏูููุฉ (5 ุณุงุนุงุช ู5 ุฏูุงุฆู) ูุฏุนู ูุฏุฉ ุงูุชุดุบูู ุงูุฌุฏูุฏุฉ
    timeout-minutes: 305 
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm install

      - name: Execution Logic
        env:
          U_MAIL: ${{ secrets.U_MAIL }}
          U_PASS: ${{ secrets.U_PASS }}
          ENTRY_P: ${{ secrets.ENTRY_P }}
          EXIT_P: ${{ secrets.EXIT_P }}
          MATCH_V: ${{ secrets.MATCH_V }}
          EXEC_V: ${{ secrets.EXEC_V }}
        run: |
          # ุงูุญุตูู ุนูู ุงูุณุงุนุฉ ุงูุญุงููุฉ ุจุชูููุช ููุฉ (UTC+3)
          HOUR=$(date -u -d "+3 hours" +%H)
          
          echo "โฐ ุงูุณุงุนุฉ ุงูุขู ุจุชูููุช ููุฉ ุงูููุฑูุฉ: $HOUR"

          # ุงูุชููู ุงูุฅุฌุจุงุฑู ุฅุฐุง ูุงูุช ุงูุณุงุนุฉ ุจูู 4 ู 8 ุตุจุงุญุงู ุจุชูููุช ููุฉ
          if [ "$HOUR" -ge 4 ] && [ "$HOUR" -lt 8 ]; then
            echo "๐ค ุชูููุช ุงูุฑุงุญุฉ (4 AM - 8 AM). ุงูุณูุฑูุฑ ุณูุจูู ุฎุงููุงู."
            exit 0
          fi
          
          echo "๐ ุจุฏุก ุงูุชุดุบูู ููุฏุฉ 5 ุณุงุนุงุช (18000 ุซุงููุฉ)..."
          
          # ุชุดุบูู ุงูุจูุช ูู ุงูุฎูููุฉ
          npm start & 
          BOT_PID=$!
          
          # ุงูุงูุชุธุงุฑ ููุฏุฉ 5 ุณุงุนุงุช (18000 ุซุงููุฉ)
          # ููุงุญุธุฉ: ุฅุฐุง ุจุฏุฃุช ูุณุฎุฉ ุฌุฏูุฏุฉ ูุจู ุงูุชูุงุก ูุฐุง ุงูููุชุ ุณูููู GitHub ุจุฅููุงู ูุฐู ุงููุณุฎุฉ
          sleep 18000 
          
          echo "๐ ุงูุชูุช ุงูู 5 ุณุงุนุงุชุ ุฌุงุฑู ุฅุบูุงู ุงูุฌูุณุฉ ููุณูุงุญ ุจุงูุชุดุบูู ุงูุฌุฏูุฏ..."
          kill $BOT_PID || true
