name: Continuous Bot Runner

on:
  schedule:
    # ุณูุชู ุชุดุบูู ุงูุจูุช ูู 5 ุณุงุนุงุช ูุถูุงู ุนุฏู ุชุฎุทู ุญุงุฌุฒ ุงูู 6 ุณุงุนุงุช ุงูุฎุงุต ุจู GitHub
    - cron: '0 */5 * * *'
  workflow_dispatch: # ููุชุดุบูู ุงููุฏูู ุนูุฏ ุงูุญุงุฌุฉ

# ูุฐุง ุงูุฌุฒุก ูุถูู ุฅููุงู ุฃู ุฏูุฑุฉ ุณุงุจูุฉ ููุฑ ุจุฏุก ุฏูุฑุฉ ุฌุฏูุฏุฉ
concurrency:
  group: bot-running
  cancel-in-progress: true

jobs:
  run-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm install

      - name: Execution Logic
        env:
          U_MAIL: ${{ secrets.U_MAIL }}
          U_PASS: ${{ secrets.U_PASS }}
          ENTRY_P: ${{ secrets.ENTRY_P }}
          EXIT_P: ${{ secrets.EXIT_P }}
          MATCH_V: ${{ secrets.MATCH_V }}
          EXEC_V: ${{ secrets.EXEC_V }}
        run: |
          # ุงูุญุตูู ุนูู ุงูุณุงุนุฉ ุงูุญุงููุฉ ุจุชูููุช ููุฉ (ุฃู UTC+3)
          HOUR=$(date +%H -d "+3 hours")
          
          # ุงูุชุญูู ูู ูุชุฑุฉ ุงูุฑุงุญุฉ (ูู 4 ูุฌุฑุงู ุญุชู 8 ุตุจุงุญุงู)
          if [ "$HOUR" -ge 4 ] && [ "$HOUR" -lt 8 ]; then
            echo "๐ค ูุชุฑุฉ ุงูุฑุงุญุฉ ุญุงููุงู.. ุณูุชู ุฅููุงู ุงูุชุดุบูู."
            exit 0
          fi
          
          echo "๐ ุจุฏุก ุชุดุบูู ุงูุจูุช..."
          npm start
